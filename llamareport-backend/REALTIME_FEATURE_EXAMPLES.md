# 实时数据功能使用示例

## 📚 目录

- [基础使用](#基础使用)
- [Agent 智能问答](#agent-智能问答)
- [综合分析示例](#综合分析示例)
- [高级应用场景](#高级应用场景)

---

## 基础使用

### 示例 1: 查询实时股价

**问题**: "贵州茅台现在多少钱？"

**Agent 执行流程**:
```
1. 识别意图: 查询实时股价
2. 选择工具: get_realtime_stock_price
3. 调用工具: get_realtime_stock_price("600519.SH")
4. 返回结果: 格式化的股价信息
```

**预期响应**:
```
📊 **贵州茅台 (600519.SH)** 实时行情

💰 **价格信息**
- 最新价: 1,685.00 元
- 涨跌额: +15.20 元
- 涨跌幅: +0.91%
- 今开: 1,670.00 元
- 昨收: 1,669.80 元
- 最高: 1,690.00 元
- 最低: 1,665.00 元

📈 **成交信息**
- 成交量: 125,680 手
- 成交额: 21.15 亿元
- 换手率: 0.15%

💎 **估值信息**
- 市盈率: 35.2
- 市净率: 12.8
- 总市值: 21,185.50 亿元
- 流通市值: 21,185.50 亿元

🕐 更新时间: 2024-01-15 14:30:00
📡 数据来源: SinaFinance
```

---

### 示例 2: 获取最新新闻

**问题**: "贵州茅台最近有什么新闻？"

**Agent 执行流程**:
```
1. 识别意图: 查询最新新闻
2. 选择工具: get_latest_financial_news
3. 调用工具: get_latest_financial_news("贵州茅台", 10)
4. 返回结果: 新闻列表
```

**预期响应**:
```
📰 **贵州茅台** 最新新闻 (共 10 条)

1. **贵州茅台2023年度业绩快报：营收同比增长15.2%**
   - 来源: 财联社
   - 时间: 2024-01-15 09:30
   - 摘要: 贵州茅台发布2023年度业绩快报，全年实现营业收入1,503.45亿元...
   - 分类: 业绩快报

2. **茅台电商平台"i茅台"注册用户突破3000万**
   - 来源: 新浪财经
   - 时间: 2024-01-14 16:20
   - 摘要: 据茅台官方消息，i茅台APP注册用户数已突破3000万...
   - 分类: 公司动态

...

🕐 查询时间: 2024-01-15 14:30:00
```

---

### 示例 3: 检查异常预警

**问题**: "帮我看看中国平安有没有什么异常？"

**Agent 执行流程**:
```
1. 识别意图: 风险检查
2. 选择工具: check_stock_alerts
3. 调用工具: check_stock_alerts("601318.SH")
4. 分析: 检查价格、成交量、估值等异常
5. 返回结果: 预警列表或正常提示
```

**预期响应（有预警）**:
```
⚠️ **中国平安 (601318.SH)** 预警信息

📊 当前价格: 42.35 元 (-6.25%)

1. 🚨 **价格异常** (critical)
   - 详情: 涨跌幅达到 -6.25%，超过正常波动范围
   - 建议: 建议密切关注，查看相关公告和新闻

2. ⚠️ **换手率异常** (warning)
   - 详情: 换手率达到 12.35%，交易异常活跃
   - 建议: 可能存在资金大幅进出，注意风险

🕐 检查时间: 2024-01-15 14:30:00
```

**预期响应（无预警）**:
```
✅ 中国平安 (601318.SH) 当前无异常预警
```

---

## Agent 智能问答

### 示例 4: 综合投资分析

**问题**: "我想投资贵州茅台，帮我做个全面分析"

**Agent 执行流程**:
```
1. 分析需求: 需要综合分析（历史+实时）
2. 执行多个工具调用:
   a. annual_report_query("贵州茅台2023年财务数据")
   b. get_realtime_stock_price("600519.SH")
   c. get_latest_financial_news("贵州茅台", 5)
   d. check_stock_alerts("600519.SH")
   e. generate_visualization(数据)
3. 综合分析: 整合历史和实时数据
4. 生成建议: 基于全面信息给出投资建议
```

**预期响应**:
```
📊 **贵州茅台投资分析报告**

【一、历史表现分析】（基于2023年年报）
根据年报数据显示：
- 营业收入: 1,503.45亿元，同比增长15.2%
- 净利润: 627.18亿元，同比增长16.8%
- ROE: 32.5%，保持高位
- 资产负债率: 28.3%，财务稳健

财务质量优秀，盈利能力强，现金流充沛。

【二、当前市场表现】（实时数据）
- 当前股价: 1,685.00 元
- 涨跌幅: +0.91%
- PE (TTM): 35.2 倍
- PB: 12.8 倍
- 市值: 21,185 亿元

估值处于历史中等偏低水平，相对合理。

【三、最新动态】
1. [2024-01-15] 业绩快报显示全年超预期完成
2. [2024-01-14] i茅台用户突破3000万
3. [2024-01-12] 获"中国品牌价值500强"第一名

最新动态积极，市场情绪偏正面。

【四、风险提示】
✅ 当前无异常预警
- 价格波动正常
- 成交量正常
- 估值合理

【五、投资建议】
综合评分: ⭐⭐⭐⭐ (8.5/10)

建议: 可以关注
理由:
1. 基本面优秀，业绩持续增长
2. 估值处于合理区间
3. 最新动态积极
4. 行业地位稳固

风险点:
1. 白酒行业受政策影响
2. 估值仍处于高位，短期上涨空间有限
3. 需要关注消费复苏情况
```

---

### 示例 5: 历史与实时数据对比

**问题**: "贵州茅台年报说今年要增长15%，实际完成得怎么样？"

**Agent 执行流程**:
```
1. 从年报提取: 年初增长目标
2. 获取实时数据: 最新业绩快报
3. 对比分析: 实际完成情况
4. 生成结论: 目标完成度评估
```

**预期响应**:
```
📊 **贵州茅台业绩完成情况分析**

【年初目标】（来自2023年报）
- 营收目标: 1,500 亿元
- 增长目标: 15%
- 利润目标: 620 亿元

【实际完成】（来自最新公告）
- 实际营收: 1,503.45 亿元
- 实际增长: 15.2%
- 实际利润: 627.18 亿元

【完成度分析】
✅ 营收: 完成率 100.2%，超额完成
✅ 增长: 实际 15.2% vs 目标 15%，超预期
✅ 利润: 完成率 101.2%，超额完成

【结论】
管理层目标全面完成，执行力优秀。
超额完成体现了公司良好的经营能力。
```

---

## 综合分析示例

### 示例 6: 行业对比分析

**问题**: "对比一下贵州茅台和五粮液，哪个更值得投资？"

**Agent 执行流程**:
```
1. 获取两家公司的实时数据
2. 从年报查询历史业绩
3. 对比估值、盈利能力、增长速度
4. 生成对比分析报告
```

**预期响应**:
```
📊 **贵州茅台 vs 五粮液 对比分析**

【实时行情对比】
                贵州茅台        五粮液
当前价格        1,685.00        152.30
涨跌幅          +0.91%         +1.25%
市盈率          35.2           28.5
市净率          12.8           8.6
市值           21,185亿        5,892亿

【历史业绩对比】（2023年报）
                贵州茅台        五粮液
营收            1,503亿         817亿
增长率          15.2%          12.8%
净利润          627亿           286亿
ROE             32.5%          25.3%

【综合评分】
贵州茅台: ⭐⭐⭐⭐ (8.5/10)
- 优势: 品牌力强、盈利能力优秀、现金流好
- 劣势: 估值略高、增长空间有限

五粮液: ⭐⭐⭐⭐ (8.0/10)
- 优势: 估值相对较低、增长潜力大
- 劣势: 品牌力稍弱、ROE 较低

【投资建议】
- 稳健型投资者: 选择贵州茅台（质量更优）
- 成长型投资者: 关注五粮液（估值更低）
```

---

## 高级应用场景

### 场景 1: 实时监控 + 预警

**需求**: 监控持仓股票，异常时提醒

**实现方案**:

```python
# 方案 A: 使用 Agent 定期查询
import asyncio

async def monitor_stocks(stock_codes: list):
    """监控股票列表"""
    while True:
        for code in stock_codes:
            # 检查预警
            alerts = check_stock_alerts(code)
            if "异常" in alerts:
                # 发送通知
                send_notification(alerts)
        
        # 每5分钟检查一次
        await asyncio.sleep(300)

# 方案 B: 使用 API 轮询
# 前端定期调用 /realtime/alerts/{stock_code}
```

### 场景 2: 新闻情绪分析

**需求**: 分析公司的新闻舆情

**示例问题**: "最近关于比亚迪的新闻整体是正面还是负面？"

**Agent 执行**:
```
1. get_latest_financial_news("比亚迪", 20)
2. 对每条新闻进行情绪分析
3. 统计正面/负面/中性新闻数量
4. 计算综合情绪指数
5. 生成情绪分析报告
```

**预期响应**:
```
📰 **比亚迪新闻情绪分析**

【新闻统计】（最近20条）
- 正面新闻: 15 条 (75%)
- 中性新闻: 4 条 (20%)
- 负面新闻: 1 条 (5%)

【综合情绪指数】: +0.68 (偏正面)

【主要正面新闻】
1. 比亚迪12月销量再创新高
2. 海外市场拓展成果显著
3. 新能源技术获国家奖项

【负面新闻】
1. 部分车型价格下调，竞争加剧

【结论】
市场情绪整体偏正面，公司发展势头良好。
```

### 场景 3: 事件驱动分析

**需求**: 追踪特定事件的影响

**示例问题**: "某某公司刚发布了业绩预告，对股价有什么影响？"

**Agent 执行**:
```
1. get_company_announcements(stock_code, 5)
2. 识别业绩预告公告
3. 提取业绩数据
4. get_realtime_stock_price(stock_code)
5. 分析市场反应（价格变化、成交量变化）
6. 生成影响分析报告
```

---

## 完整工作流示例

### 场景: 深度投资研究报告

**用户请求**: 
```json
{
  "task": "生成贵州茅台的深度投资研究报告",
  "requirements": [
    "包含历史业绩分析",
    "包含实时市场表现",
    "包含最新动态追踪",
    "给出投资评级和目标价"
  ]
}
```

**Agent 执行计划**:

```
第一阶段: 历史分析（年报数据）
├── 1. annual_report_query("贵州茅台 2023年 财务数据")
├── 2. generate_financial_review("贵州茅台", "2023")
├── 3. generate_dupont_analysis("贵州茅台", "2023")
└── 输出: 历史业绩分析报告

第二阶段: 现状分析（实时数据）
├── 4. get_realtime_stock_price("600519.SH")
├── 5. get_market_overview()
├── 6. check_stock_alerts("600519.SH")
└── 输出: 当前市场状况分析

第三阶段: 动态追踪（新闻/公告）
├── 7. get_latest_financial_news("贵州茅台", 10)
├── 8. get_company_announcements("600519.SH", 10)
├── 9. 情绪分析
└── 输出: 最新动态分析

第四阶段: 综合分析
├── 10. generate_visualization(历史+实时数据)
├── 11. 风险评估
├── 12. 估值分析
└── 输出: 投资评级和建议

最终报告结构:
一、公司概况
二、历史业绩分析（年报数据）
三、当前市场表现（实时数据）
四、最新动态追踪（新闻/公告）
五、估值分析
六、风险评估
七、投资建议
```

**生成报告示例**:

```markdown
# 贵州茅台深度投资研究报告

**股票代码**: 600519.SH  
**报告日期**: 2024-01-15  
**分析师**: LlamaReport AI Agent

---

## 一、公司概况

贵州茅台酒股份有限公司是中国白酒行业的龙头企业...

## 二、历史业绩分析

### 2.1 财务数据（2023年报）
- 营业收入: 1,503.45 亿元（+15.2%）
- 净利润: 627.18 亿元（+16.8%）
- 毛利率: 91.2%
- ROE: 32.5%

### 2.2 杜邦分析
[可视化图表: ROE 分解]
...

## 三、当前市场表现

### 3.1 实时行情（2024-01-15 14:30）
- 股价: 1,685.00 元（+0.91%）
- PE (TTM): 35.2 倍
- 市值: 21,185 亿元

### 3.2 市场情绪
- 大盘走势: 上证指数 +0.5%
- 行业表现: 白酒板块 +0.8%
- 个股表现: 跑赢大盘

## 四、最新动态

### 4.1 重要新闻
1. 业绩快报超预期
2. 新品发布计划
3. 海外市场拓展

### 4.2 公司公告
1. 2023年度业绩快报
2. 董事会决议公告
3. 分红预案

### 4.3 情绪分析
- 新闻情绪: +0.72 (偏正面)
- 市场反应: 积极

## 五、估值分析

### 5.1 绝对估值
- 当前 PE: 35.2 倍
- 历史 PE 中位数: 38.5 倍
- 估值水平: 中等偏低

### 5.2 相对估值
- 行业平均 PE: 32.0 倍
- 相对估值: 略高于行业

### 5.3 目标价
基于 DCF 模型，合理估值区间: 1,650 - 1,800 元

## 六、风险评估

### 6.1 系统性风险
- 宏观经济下行
- 消费复苏不及预期

### 6.2 个股风险
- 高端白酒竞争加剧
- 政策监管风险

### 6.3 当前预警
✅ 无异常预警

## 七、投资建议

**评级**: 买入 ⭐⭐⭐⭐

**目标价**: 1,750 元 (+3.9%)

**理由**:
1. 基本面优秀，业绩持续增长
2. 估值处于合理区间
3. 品牌护城河深厚
4. 最新动态积极

**建议仓位**: 中等配置（10-20%）

**关注要点**:
- Q1 业绩表现
- 消费复苏进度
- 行业竞争格局

---

*本报告由 LlamaReport AI Agent 自动生成*  
*数据来源: 年报数据 + 实时行情 + 新闻公告*  
*免责声明: 本报告仅供参考，不构成投资建议*
```

---

## 使用技巧

### 技巧 1: 明确指定数据时效性

**不太好的问法**:
- "茅台的营收是多少？" （不清楚要历史还是实时）

**更好的问法**:
- "茅台去年的营收是多少？" （明确指向年报）
- "茅台现在的股价是多少？" （明确指向实时）
- "茅台的营收趋势如何？过去3年和现在" （明确要对比）

### 技巧 2: 组合使用多个工具

**问题**: "帮我做个完整分析"

**优化问题**:
```
"请分析贵州茅台的投资价值，需要包括：
1. 过去3年的业绩趋势
2. 当前的股价和估值水平
3. 最近1个月的新闻动态
4. 是否有异常预警
5. 综合投资建议"
```

这样 Agent 会知道需要调用多个工具。

### 技巧 3: 利用上下文

```
用户: "贵州茅台的历史业绩怎么样？"
Agent: [分析年报数据]

用户: "那现在的股价呢？"  # Agent 会记住是在问茅台
Agent: [调用实时数据工具]

用户: "综合来看值得买吗？"  # Agent 会结合前面的信息
Agent: [综合历史和实时数据给建议]
```

---

## 注意事项

### ⚠️ 数据时效性

- **年报数据**: 可能滞后 3-12 个月
- **实时数据**: 延迟 < 5 秒
- **新闻数据**: 延迟 < 5 分钟

### ⚠️ 数据准确性

- 实时数据来自第三方，可能存在延迟或误差
- 建议交叉验证重要数据
- 投资决策请以官方公告为准

### ⚠️ API 限制

- **新浪财经**: 免费，无限制，但请控制频率
- **Tushare 免费版**: 每分钟 200 次
- **Tushare 专业版**: 无限制

### ⚠️ 免责声明

本系统提供的所有数据和分析仅供参考，不构成投资建议。
投资有风险，决策需谨慎。

---

## 相关文档

- [实时数据使用指南](./REALTIME_DATA_GUIDE.md)
- [Agent 系统文档](./AGENT_README.md)
- [API 文档](http://localhost:8000/docs)
- [项目 README](./README.md)

---

**版本**: 1.0.0  
**最后更新**: 2024-01-15

