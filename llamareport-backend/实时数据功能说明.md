# 实时数据功能说明

## 🎯 功能概述

LlamaReport Backend 现在支持**实时数据/新闻**功能！系统已从"历史年报分析工具"升级为"全方位财务智能平台"。

---

## ✨ 新增功能

### 1. 📈 实时股价查询

**功能**: 获取股票最新价格、涨跌幅、成交量、估值指标

**示例问题**:
- "贵州茅台现在多少钱？"
- "中国平安的实时股价是多少？"
- "帮我查一下比亚迪的市盈率"

**数据来源**: 新浪财经（免费）、Tushare（可选）

---

### 2. 📰 财经新闻追踪

**功能**: 获取公司最新新闻、行业动态

**示例问题**:
- "贵州茅台最近有什么新闻？"
- "比亚迪有什么重要动态吗？"
- "新能源汽车行业最近怎么样？"

**数据来源**: 财联社、新浪财经、东方财富（聚合）

---

### 3. 📢 公司公告获取

**功能**: 获取官方公告、业绩预告、重大事项

**示例问题**:
- "茅台最近发了什么公告？"
- "有业绩预告吗？"
- "查一下最新的股东大会决议"

**数据来源**: Tushare、巨潮资讯网

---

### 4. ⚠️ 智能预警检测

**功能**: 自动检测价格异常、成交量异常、估值风险

**示例问题**:
- "帮我检查一下XX公司有没有异常？"
- "这只股票有风险吗？"
- "监控我的持仓股票"

**检测项目**:
- 价格异常（涨跌幅 > 5%）
- 成交量异常（换手率 > 10%）
- 估值风险（PE < 0 或 > 100）

---

### 5. 📊 市场概览

**功能**: 查看主要指数实时情况

**示例问题**:
- "今天大盘走势怎么样？"
- "A股现在什么情况？"
- "创业板表现如何？"

**包含指数**: 上证指数、深证成指、创业板指

---

### 6. 🔄 综合投资分析

**功能**: 结合历史和实时数据的深度分析

**示例问题**:
- "贵州茅台值得投资吗？"
- "帮我分析一下中国平安的投资价值"
- "给我做个比亚迪的完整分析报告"

**分析维度**:
- 历史业绩（年报数据）
- 当前状况（实时数据）
- 最新动态（新闻公告）
- 风险评估（智能预警）
- 投资建议（综合评分）

---

## 🚀 快速开始

### 步骤 1: 安装依赖

```bash
pip install -r requirements.txt
```

### 步骤 2: 配置环境（可选）

编辑 `.env` 文件:

```env
# 必需
OPENAI_API_KEY=your-key
DEEPSEEK_API_KEY=your-key

# 可选（推荐）
TUSHARE_API_TOKEN=your-token  # 从 https://tushare.pro 获取
ENABLE_REALTIME_DATA=true
```

**重要**: 
- ✅ 不配置 `TUSHARE_API_TOKEN` 也能使用（会用新浪财经）
- ✅ 新浪财经完全免费，无需注册

### 步骤 3: 启动服务

```bash
python main.py
```

### 步骤 4: 测试功能

**方式 1: 使用演示脚本**
```bash
python examples/realtime_data_demo.py
```

**方式 2: 调用 API**
```bash
# 查询实时股价
curl http://localhost:8000/realtime/quote/600519.SH

# 通过 Agent 查询
curl -X POST http://localhost:8000/agent/query \
  -H "Content-Type: application/json" \
  -d '{"question": "贵州茅台现在多少钱？"}'
```

**方式 3: 访问 API 文档**
```
http://localhost:8000/docs
```

在文档中找到 `/realtime` 标签下的接口。

---

## 💡 使用示例

### 示例 1: 简单查询

```
问: "帮我查一下贵州茅台现在的股价"

答: 
📊 **贵州茅台 (600519.SH)** 实时行情

💰 **价格信息**
- 最新价: 1,685.00 元
- 涨跌幅: +0.91%
- 成交量: 125,680 手

💎 **估值信息**
- 市盈率: 35.2
- 市值: 21,185.50 亿元

🕐 更新时间: 2024-01-15 14:30:00
```

---

### 示例 2: 综合分析

```
问: "贵州茅台值得投资吗？"

答:
📊 **贵州茅台投资分析**

【历史表现】（2023年报）
- 营收: 1,503亿元 (+15.2%)
- 净利润: 627亿元 (+16.8%)
- ROE: 32.5%
评价: 业绩优秀，持续增长

【当前状况】（实时数据）
- 股价: 1,685元 (+0.91%)
- PE: 35.2 倍
- 估值: 中等偏低
评价: 估值合理

【最新动态】
- Q3业绩超预期
- 新品发布计划
- 市场情绪积极

【风险评估】
✅ 无异常预警

【投资建议】
评分: ⭐⭐⭐⭐ (8.5/10)
建议: 可以关注
理由: 基本面优秀，估值合理，动态积极
```

---

### 示例 3: 对比分析

```
问: "茅台年报说今年要增长15%，现在完成得怎么样？"

答:
📊 **业绩完成度分析**

【年初目标】（年报）
- 营收目标: 1,500 亿元
- 增长目标: 15%

【实际完成】（最新公告）
- 实际营收: 1,503 亿元
- 实际增长: 15.2%

【完成度】
✅ 营收: 100.2%（超额完成）
✅ 增长: 超预期 0.2%

【结论】
管理层目标全面完成，执行力优秀。
```

---

## 🔧 技术特点

### 1. 基于 LlamaIndex FunctionTool

完全遵循 LlamaIndex 官方文档的标准模式:

```python
# 官方推荐的工具创建方式
tool = FunctionTool.from_defaults(
    fn=function,
    name="tool_name",
    description="详细描述"
)
```

### 2. 智能工具选择

Agent 会**自动判断**需要使用哪些工具:

```
历史问题 → 使用年报工具
实时问题 → 使用实时工具
综合问题 → 同时使用多个工具
```

### 3. 多数据源容错

```
新浪财经（主） → Tushare（备） → 友好错误
```

---

## 📚 完整文档列表

1. **REALTIME_DATA_GUIDE.md** - 📖 完整使用指南
   - 配置说明、API 文档、故障排除

2. **REALTIME_FEATURE_EXAMPLES.md** - 📚 详细示例
   - 基础使用、Agent 问答、综合分析

3. **REALTIME_FEATURE_SUMMARY.md** - 📊 技术总结
   - 架构设计、成本分析、预期效果

4. **UPGRADE_TO_REALTIME.md** - 🔄 升级指南
   - 升级步骤、配置详解、回滚方案

5. **REALTIME_FEATURE_CHECKLIST.md** - ✅ 功能清单
   - 完成项目、代码统计、质量保证

6. **REALTIME_IMPLEMENTATION_REPORT.md** - 📝 实施报告
   - 完整的技术实施报告

---

## 🎁 额外福利

### 数据源说明

| 数据源 | 成本 | 特点 | 推荐度 |
|--------|------|------|--------|
| **新浪财经** | 免费 | 实时性好，无需 Token | ⭐⭐⭐⭐⭐ |
| **Tushare 免费** | 免费 | 数据全面，需注册 | ⭐⭐⭐⭐ |
| **Tushare Pro** | 500元/月 | 无限制，最全面 | ⭐⭐⭐⭐⭐ |

### 推荐配置

**入门用户**: 只用新浪财经（免费）
```env
# 无需配置 TUSHARE_API_TOKEN
ENABLE_REALTIME_DATA=true
```

**进阶用户**: 新浪 + Tushare 免费版
```env
TUSHARE_API_TOKEN=your-free-token  # 注册获取
ENABLE_REALTIME_DATA=true
```

**专业用户**: Tushare Pro
```env
TUSHARE_API_TOKEN=your-pro-token   # 付费升级
ENABLE_REALTIME_DATA=true
```

---

## 🆘 需要帮助？

### 快速诊断

运行快速入门脚本:
```bash
python quick_start_realtime.py
```

这个脚本会:
- ✅ 检查依赖是否安装
- ✅ 检查环境变量配置
- ✅ 测试数据源连接
- ✅ 测试工具函数
- ✅ 给出下一步建议

### 查看文档

按需查看相应文档:
- 🔰 新手: `REALTIME_DATA_GUIDE.md`
- 📖 示例: `REALTIME_FEATURE_EXAMPLES.md`
- 🔧 升级: `UPGRADE_TO_REALTIME.md`
- 🐛 问题: 查看各文档的"故障排除"章节

### 测试演示

```bash
python examples/realtime_data_demo.py
```

---

## 🎉 开始使用

1. ✅ 安装依赖: `pip install -r requirements.txt`
2. ✅ 配置环境: 编辑 `.env` 文件（可选）
3. ✅ 运行诊断: `python quick_start_realtime.py`
4. ✅ 启动服务: `python main.py`
5. ✅ 测试功能: `python examples/realtime_data_demo.py`

**就这么简单！** 🚀

---

**版本**: v1.1.0  
**发布日期**: 2024-01-15  
**状态**: ✅ 已完成

---

## 📞 联系我们

如有问题，请:
1. 查看文档（5份完整文档）
2. 运行诊断脚本（`quick_start_realtime.py`）
3. 查看日志（`llamareport-backend.log`）
4. 提交 Issue

